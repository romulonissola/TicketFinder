"use strict";(self.webpackChunkticket_finder_app=self.webpackChunkticket_finder_app||[]).push([[140],{7140:(dt,Z,s)=>{s.r(Z),s.d(Z,{TapModule:()=>pt});var _=s(6814),A=s(1896);function x(n,o,r,e,a,i,c){try{var l=n[i](c),p=l.value}catch(m){return void r(m)}l.done?o(p):Promise.resolve(p).then(e,a)}var P=s(2096),T=s(8180),O=s(7921),D=s(7398),f=s(1660),t=s(5879),u=s(6223),I=s(1842),C=s(5195),h=s(9157),Q=s(3680),M=s(2032),w=s(2296),b=s(6381),g=s(8034),d=s(9221),S=s(5986),q=s(6007),F=s(3566);const J=["tableOut"],U=["tableIn"];function G(n,o){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Invalid start date"),t.qZA())}function R(n,o){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Invalid end date"),t.qZA())}function W(n,o){if(1&n&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&n){const r=o.$implicit,e=t.oxw();t.Q6J("value",r),t.xp6(1),t.Oqu(e.displayFn(r))}}function B(n,o){if(1&n&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&n){const r=o.$implicit,e=t.oxw();t.Q6J("value",r),t.xp6(1),t.Oqu(e.displayFn(r))}}function E(n,o){1&n&&t._UZ(0,"mat-progress-bar",24)}function L(n,o){1&n&&(t.TgZ(0,"th",36),t._uU(1,"date"),t.qZA())}function H(n,o){if(1&n&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&n){const r=o.$implicit;t.xp6(1),t.Oqu(r.date)}}function $(n,o){1&n&&(t.TgZ(0,"th",36),t._uU(1,"Price"),t.qZA())}function z(n,o){if(1&n&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&n){const r=o.$implicit,e=t.oxw(2);t.xp6(1),t.AsE(" ",e.currentCurrencyOut," ",null==r.totalPrice?null:r.totalPrice.price," ")}}function X(n,o){1&n&&t._UZ(0,"tr",38)}function j(n,o){1&n&&t._UZ(0,"tr",39)}function k(n,o){1&n&&(t.TgZ(0,"th",36),t._uU(1,"date"),t.qZA())}function K(n,o){if(1&n&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&n){const r=o.$implicit;t.xp6(1),t.Oqu(r.date)}}function V(n,o){1&n&&(t.TgZ(0,"th",36),t._uU(1,"Price"),t.qZA())}function tt(n,o){if(1&n&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&n){const r=o.$implicit,e=t.oxw(3);t.xp6(1),t.AsE(" ",e.currentCurrencyOut," ",null==r.totalPrice?null:r.totalPrice.price," ")}}function et(n,o){1&n&&t._UZ(0,"tr",38)}function nt(n,o){1&n&&t._UZ(0,"tr",39)}function at(n,o){if(1&n){const r=t.EpF();t.TgZ(0,"div",40)(1,"h1"),t._uU(2,"Volta"),t.qZA(),t.TgZ(3,"table",27,41),t.NdJ("matSortChange",function(a){t.CHM(r);const i=t.oxw(2);return t.KtG(i.sortInChange(a))}),t.ynx(5,29),t.YNc(6,k,2,0,"th",30),t.YNc(7,K,2,1,"td",31),t.BQk(),t.ynx(8,32),t.YNc(9,V,2,0,"th",30),t.YNc(10,tt,2,2,"td",31),t.BQk(),t.YNc(11,et,1,0,"tr",33),t.YNc(12,nt,1,0,"tr",34),t.qZA()()}if(2&n){const r=t.oxw(2);t.xp6(3),t.Q6J("dataSource",r.inPanelPrices),t.xp6(8),t.Q6J("matHeaderRowDef",r.displayedColumnsIn),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumnsIn)}}function rt(n,o){if(1&n){const r=t.EpF();t.TgZ(0,"div",25)(1,"div",26)(2,"h1"),t._uU(3,"Ida"),t.qZA(),t.TgZ(4,"table",27,28),t.NdJ("matSortChange",function(a){t.CHM(r);const i=t.oxw();return t.KtG(i.sortOutChange(a))}),t.ynx(6,29),t.YNc(7,L,2,0,"th",30),t.YNc(8,H,2,1,"td",31),t.BQk(),t.ynx(9,32),t.YNc(10,$,2,0,"th",30),t.YNc(11,z,2,2,"td",31),t.BQk(),t.YNc(12,X,1,0,"tr",33),t.YNc(13,j,1,0,"tr",34),t.qZA()(),t.YNc(14,at,13,3,"div",35),t.qZA()}if(2&n){const r=t.oxw();t.xp6(4),t.Q6J("dataSource",r.outPanelPrices),t.xp6(8),t.Q6J("matHeaderRowDef",r.displayedColumnsOut),t.xp6(1),t.Q6J("matRowDefColumns",r.displayedColumnsOut),t.xp6(1),t.Q6J("ngIf",!r.oneWay)}}function it(n,o){if(1&n&&(t.TgZ(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t._uU(3),t.qZA()()()),2&n){const r=o.$implicit;t.xp6(3),t.Oqu(r)}}function ot(n,o){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,it,4,1,"mat-card",42),t.qZA()),2&n){const r=t.oxw();t.xp6(1),t.Q6J("ngForOf",r.errors)}}const st=[{path:"",component:(()=>{var n;class o{get oneWay(){return this.searchForm.controls.oneWay.value}constructor(e,a){this.fb=e,this.tapService=a,this.originAirports=[],this.destinationAirports=[],this.originFilteredOptions=(0,P.of)([]),this.destinationFilteredOptions=(0,P.of)([]),this.outPanelPrices=[],this.inPanelPrices=[],this.errors=[],this.originDefault="LON",this.destinationDefault="POA",this.marketCode="GBP",this.currentCurrencyOut="",this.currentCurrencyIn="",this.displayedColumnsOut=["date","price"],this.displayedColumnsIn=["date","price"],this.loading=0,this.searchForm=this.fb.group({origin:[""],destination:[""],tripType:["R"],paxType:["ADT"],start:null,end:null,oneWay:!1})}ngOnInit(){this.tapService.getOriginAirports().pipe((0,T.q)(1)).subscribe(e=>{this.originAirports=e.data.origins,this.translateAirport=e.data.translateAirport,this.translateCity=e.data.translateCity,this.translateCountry=e.data.translateCountry;const a=this.originAirports.find(i=>i.airport===this.originDefault);a&&(this.searchForm.controls.origin.setValue(a),this.loadDestinationAirports(this.destinationDefault))}),this.originFilteredOptions=this.searchForm.controls.origin.valueChanges.pipe((0,O.O)(""),(0,D.U)(e=>{const a="string"==typeof e?e:e?.airport;return a?this._filter(a):this.originAirports.slice()})),this.destinationFilteredOptions=this.searchForm.controls.destination.valueChanges.pipe((0,O.O)(""),(0,D.U)(e=>{const a="string"==typeof e?e:e?.airport;return a?this._filter(a):this.destinationAirports.slice()}))}displayFn(e){return this.translateAirport&&this.translateCity&&this.translateCountry&&e?`${e.airport} - ${this.translateCity[e.city]} - ${this.translateCountry[e.country]}`:""}_filter(e){const a=e.toLowerCase();return this.originAirports.filter(i=>i.airport.toLowerCase().includes(a)||i.city.toLowerCase().includes(a)||i.country.toLowerCase().includes(a)||this.translateAirport&&this.translateAirport[i.airport].toLowerCase().includes(a)||this.translateCity&&this.translateCity[i.city].toLowerCase().includes(a)||this.translateCountry&&this.translateCountry[i.country].toLowerCase().includes(a))}loadDestinationAirports(e){this.tapService.getDestinationAirports(this.searchForm.controls.origin.value.airport).pipe((0,T.q)(1)).subscribe(a=>{if(this.destinationAirports=a.data.destinations,e){const i=this.destinationAirports.find(c=>c.airport===e);i&&this.searchForm.controls.destination.setValue(i)}})}search(){this.tapService.createToken(this.marketCode).pipe((0,T.q)(1)).subscribe(()=>this.findBestPrices())}findBestPrices(){var e=this;return function N(n){return function(){var o=this,r=arguments;return new Promise(function(e,a){var i=n.apply(o,r);function c(p){x(i,e,a,c,l,"next",p)}function l(p){x(i,e,a,c,l,"throw",p)}c(void 0)})}}(function*(){e.outPanelPrices=[],e.inPanelPrices=[],e.errors=[];const a=e.searchForm.controls.start.value,i=e.searchForm.controls.end.value;let c=new Date;for(let l=0;c<i;l++){c=e.addDays(a,l);const p=e.addDays(c,7);console.table({date:new Date,startDate:c,endDate:p}),e.loading++,e.tapService.getTicketPrices(c,p,e.marketCode,e.searchForm.controls.origin.value.airport,e.searchForm.controls.destination.value.airport,e.searchForm.controls.oneWay.value).pipe((0,T.q)(1)).subscribe(m=>{if("200"===m.response.status){e.currentCurrencyOut=m.response.data.outPanel.currency;const v=m.response.data.outPanel.listTab.find(y=>y.date===(0,f.pG)(m.startDate));v&&e.outPanelPrices.push(v),e.currentCurrencyIn=m.response.data.inPanel.currency;const Y=m.response.data.inPanel.listTab.find(y=>y.date===(0,f.pG)(m.endDate));Y&&e.inPanelPrices.push(Y),e.tableIn?.renderRows(),e.sortInChange({active:"price",direction:"asc"}),e.tableOut?.renderRows(),e.sortOutChange({active:"price",direction:"asc"})}else e.errors.push(...m.response.errors.map(v=>v.desc));e.loading--}),yield(0,f._v)(1e3)}})()}objToString(e){return e?JSON.stringify(e):""}addDays(e,a){const i=new Date(e);return i.setDate(e.getDate()+a),i}orderByCheaperPrice(e){return e.sort((a,i)=>(a.totalPrice?.price??0)-(i.totalPrice?.price??0))}sortOutChange(e){this.outPanelPrices=this.sortTable(this.outPanelPrices,e)}sortTable(e,a){const i=e.slice();return a.active&&""!==a.direction?i.sort((c,l)=>{const p="asc"===a.direction;switch(a.active){case"date":return(0,f.qu)(c.date,l.date,p);case"price":return(0,f.qu)(c.totalPrice?.price??0,l.totalPrice?.price??0,p);default:return 0}}):i}sortInChange(e){this.inPanelPrices=this.sortTable(this.inPanelPrices,e)}}return(n=o).\u0275fac=function(e){return new(e||n)(t.Y36(u.qu),t.Y36(I.P))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tap"]],viewQuery:function(e,a){if(1&e&&(t.Gf(J,5),t.Gf(U,5),t.Gf(J,5),t.Gf(U,5)),2&e){let i;t.iGM(i=t.CRH())&&(a.tableOut=i.first),t.iGM(i=t.CRH())&&(a.tableIn=i.first),t.iGM(i=t.CRH())&&(a.sortOut=i.first),t.iGM(i=t.CRH())&&(a.sortIn=i.first)}},decls:46,vars:18,consts:[[1,"search-container"],[3,"formGroup","submit"],[1,"search-form"],[1,"search-fields"],[3,"rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],["picker",""],[4,"ngIf"],[1,"full-width","autocomplete"],["type","text","matInput","","formControlName","origin",3,"matAutocomplete"],["name","origin",3,"displayWith","optionSelected"],["originAuto",""],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","formControlName","destination",3,"matAutocomplete"],["name","destination",3,"displayWith"],["destinationAuto",""],["formControlName","oneWay"],[1,"search-button"],["mat-raised-button","","color","primary","type","submit"],["mode","indeterminate",4,"ngIf"],["class","tables",4,"ngIf"],[3,"value"],["mode","indeterminate"],[1,"tables"],[1,"left-table"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource","matSortChange"],["tableOut",""],["matColumnDef","date"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","right-table",4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"right-table"],["tableIn",""],[4,"ngFor","ngForOf"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),t._uU(4,"TAP"),t.qZA()(),t.TgZ(5,"mat-card-content")(6,"form",1),t.NdJ("submit",function(){return a.search()}),t.TgZ(7,"div",2)(8,"div",3)(9,"mat-form-field")(10,"mat-label"),t._uU(11,"Enter a date range"),t.qZA(),t.TgZ(12,"mat-date-range-input",4),t._UZ(13,"input",5)(14,"input",6),t.qZA(),t.TgZ(15,"mat-hint"),t._uU(16,"MM/DD/YYYY - MM/DD/YYYY"),t.qZA(),t._UZ(17,"mat-datepicker-toggle",7)(18,"mat-date-range-picker",null,8),t.YNc(20,G,2,0,"mat-error",9),t.YNc(21,R,2,0,"mat-error",9),t.qZA(),t.TgZ(22,"mat-form-field",10)(23,"mat-label"),t._uU(24,"Origin"),t.qZA(),t._UZ(25,"input",11),t.TgZ(26,"mat-autocomplete",12,13),t.NdJ("optionSelected",function(){return a.loadDestinationAirports()}),t.YNc(28,W,2,2,"mat-option",14),t.ALo(29,"async"),t.qZA()(),t.TgZ(30,"mat-form-field",10)(31,"mat-label"),t._uU(32,"Destination"),t.qZA(),t._UZ(33,"input",15),t.TgZ(34,"mat-autocomplete",16,17),t.YNc(36,B,2,2,"mat-option",14),t.ALo(37,"async"),t.qZA()(),t.TgZ(38,"mat-checkbox",18),t._uU(39,"OneWay"),t.qZA()(),t.TgZ(40,"div",19)(41,"button",20),t._uU(42," Search "),t.qZA()()()()()(),t.YNc(43,E,1,0,"mat-progress-bar",21),t.YNc(44,rt,15,4,"div",22),t.YNc(45,ot,2,1,"div",9),t.qZA()),2&e){const i=t.MAs(19),c=t.MAs(27),l=t.MAs(35);t.xp6(6),t.Q6J("formGroup",a.searchForm),t.xp6(6),t.Q6J("rangePicker",i),t.xp6(5),t.Q6J("for",i),t.xp6(3),t.Q6J("ngIf",a.searchForm.controls.start.hasError("matStartDateInvalid")),t.xp6(1),t.Q6J("ngIf",a.searchForm.controls.end.hasError("matEndDateInvalid")),t.xp6(4),t.Q6J("matAutocomplete",c),t.xp6(1),t.Q6J("displayWith",a.displayFn.bind(a)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(29,14,a.originFilteredOptions)),t.xp6(5),t.Q6J("matAutocomplete",l),t.xp6(1),t.Q6J("displayWith",a.displayFn.bind(a)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(37,16,a.destinationFilteredOptions)),t.xp6(7),t.Q6J("ngIf",a.loading>0),t.xp6(1),t.Q6J("ngIf",a.outPanelPrices.length>0),t.xp6(1),t.Q6J("ngIf",a.errors.length>0)}},dependencies:[_.sg,_.O5,C.a8,C.dn,C.dk,C.n5,h.KE,h.hX,h.bx,h.TO,h.R9,Q.ey,M.Nt,u._Y,u.Fj,u.JJ,u.JL,w.lW,b.XC,b.ZL,u.sg,u.u,g.nW,g.wx,g.zY,g.By,g._g,d.BZ,d.fO,d.as,d.w1,d.Dz,d.nj,d.ge,d.ev,d.XQ,d.Gk,S.oG,q.pW,F.YE,F.nU,_.Ov],styles:[".search-button[_ngcontent-%COMP%]{padding:10px}.search-fields[_ngcontent-%COMP%]{padding:0 10px}.search-form[_ngcontent-%COMP%]{display:contents}.tables[_ngcontent-%COMP%]{padding:10px;display:inline-flex}.right-table[_ngcontent-%COMP%], .left-table[_ngcontent-%COMP%]{padding:10px;width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]     .autocomplete .mat-mdc-form-field-infix{width:236px!important}"]}),o})()}];let ct=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[A.Bz.forChild(st),A.Bz]}),o})();var lt=s(5440);let pt=(()=>{var n;class o{}return(n=o).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.ez,ct,lt.m]}),o})()}}]);